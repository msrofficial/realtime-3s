<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Magic Hand Particles</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #000000; /* সম্পূর্ণ কালো ব্যাকগ্রাউন্ড */
        }

        /* ভিডিও এবং ক্যানভাস একই জায়গায় থাকবে */
        .container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }

        /* ভিডিও এলিমেন্ট (লুকানো থাকবে, কিন্তু প্রসেসিং চলবে) */
        .input_video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1); /* মিরর ইফেক্ট */
            opacity: 0; /* ভিডিও একদম দেখা যাবে না, শুধু পার্টিকেল দেখা যাবে */
            z-index: 0;
        }

        /* ক্যানভাস যেখানে পার্টিকেল আঁকা হবে */
        .output_canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 1; /* ভিডিওর উপরে থাকবে */
        }

        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: cyan;
            z-index: 10;
            font-family: sans-serif;
            font-size: 18px;
            text-align: center;
            text-shadow: 0 0 10px cyan;
        }
    </style>
</head>
<body>

    <div id="loading">Gathering Energy... <br> Please allow camera access.</div>

    <div class="container">
        <video class="input_video" playsinline></video>
        <canvas class="output_canvas"></canvas>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>

    <script>
        const videoElement = document.getElementsByClassName('input_video')[0];
        const canvasElement = document.getElementsByClassName('output_canvas')[0];
        const ctx = canvasElement.getContext('2d');
        const loadingText = document.getElementById('loading');

        // ক্যানভাস ফুলস্ক্রিন করা
        canvasElement.width = window.innerWidth;
        canvasElement.height = window.innerHeight;

        // হাতের বর্তমান পজিশন স্টোর করার ভেরিয়েবল
        let handTarget = { x: canvasElement.width / 2, y: canvasElement.height / 2, isActive: false };

        // --- পার্টিকেল সিস্টেম সেটআপ (Fun Part Starts Here) ---
        const particleCount = 250; // কতগুলো কণা থাকবে (ফোন স্লো হলে কমাতে পারো)
        const particles = [];
        // অ্যানিমে স্টাইল কালার প্যালেট (নিয়ন কালার)
        const colors = ['#00ffff', '#0099ff', '#ff00ff', '#ffffff', '#39ff14']; 

        class Particle {
            constructor() {
                this.reset();
                this.x = Math.random() * canvasElement.width;
                this.y = Math.random() * canvasElement.height;
            }

            reset() {
                this.x = Math.random() * canvasElement.width;
                this.y = Math.random() * canvasElement.height;
                this.size = Math.random() * 3 + 1;
                this.speedX = Math.random() * 4 - 2; // এলোমেলো গতি
                this.speedY = Math.random() * 4 - 2;
                this.color = colors[Math.floor(Math.random() * colors.length)];
                this.friction = 0.95; // ঘর্ষণ, যাতে গতি কমে আসে
            }

            update() {
                // যদি হাত ডিটেক্ট হয়, আঙুলের দিকে আকর্ষণ বল প্রয়োগ করো
                if (handTarget.isActive) {
                    const dx = handTarget.x - this.x;
                    const dy = handTarget.y - this.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    // যত কাছে আসবে, আকর্ষণ তত বাড়বে (Gravity effect)
                    const force = (100 / (distance + 10)); 
                    const angle = Math.atan2(dy, dx);
                    
                    this.speedX += Math.cos(angle) * force;
                    this.speedY += Math.sin(angle) * force;
                } else {
                    // হাত না থাকলে এলোমেলো ভাসতে থাকবে
                    if (Math.random() > 0.98) {
                         this.speedX += Math.random() * 2 - 1;
                         this.speedY += Math.random() * 2 - 1;
                    }
                }

                // গতির সাথে ঘর্ষণ যোগ করা (যাতে খুব বেশি জোরে না ছোটে)
                this.speedX *= this.friction;
                this.speedY *= this.friction;

                // পজিশন আপডেট
                this.x += this.speedX;
                this.y += this.speedY;

                // স্ক্রিনের বাইরে চলে গেলে আবার ভেতরে আনা
                if (this.x < 0) this.x = canvasElement.width;
                if (this.x > canvasElement.width) this.x = 0;
                if (this.y < 0) this.y = canvasElement.height;
                if (this.y > canvasElement.height) this.y = 0;
            }

            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                // গ্লো ইফেক্ট যোগ করা
                ctx.shadowBlur = 10;
                ctx.shadowColor = this.color;
                ctx.fill();
            }
        }

        // পার্টিকেল তৈরি করা
        for (let i = 0; i < particleCount; i++) {
            particles.push(new Particle());
        }

        // অ্যানিমেশন লুপ (প্রতি ফ্রেমে চলবে)
        function animateParticles() {
            // ক্যানভাস পরিষ্কার করা (Trail effect এর জন্য হালকা কালো প্রলেপ)
            ctx.fillStyle = 'rgba(0, 0, 0, 0.2)'; 
            ctx.fillRect(0, 0, canvasElement.width, canvasElement.height);
            
            ctx.shadowBlur = 0; // শ্যাডো রিসেট

            particles.forEach(particle => {
                particle.update();
                particle.draw();
            });
            requestAnimationFrame(animateParticles);
        }
        animateParticles(); // অ্যানিমেশন শুরু

        // --- MediaPipe হ্যান্ড ট্র্যাকিং লজিক ---
        function onResults(results) {
            loadingText.style.display = 'none';
            
            // আমরা ভিডিও ড্র করব না, শুধু পার্টিকেল দেখাবো, তাই ভিডিও ড্র এর কোড বাদ দিয়েছি।
            
            if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                const landmarks = results.multiHandLandmarks[0];
                // ৮ নাম্বার পয়েন্ট হলো তর্জনীর মাথা (Index Finger Tip)
                const indexFingerTip = landmarks[8];
                
                // মিরর ইফেক্ট ঠিক করে আঙুলের পজিশন সেট করা
                handTarget.x = (1 - indexFingerTip.x) * canvasElement.width;
                handTarget.y = indexFingerTip.y * canvasElement.height;
                handTarget.isActive = true;
            } else {
                // হাত না থাকলে আকর্ষণ বন্ধ
                handTarget.isActive = false;
            }
        }

        const hands = new Hands({locateFile: (file) => {
            return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
        }});

        hands.setOptions({
            maxNumHands: 1,
            modelComplexity: 0, // ফাস্ট পারফরম্যান্সের জন্য 0
            minDetectionConfidence: 0.5,
            minTrackingConfidence: 0.5
        });

        hands.onResults(onResults);

        const camera = new Camera(videoElement, {
            onFrame: async () => {
                await hands.send({image: videoElement});
            },
            width: 640, // রেজোলিউশন কমানো হয়েছে পারফরম্যান্সের জন্য
            height: 480,
            facingMode: "user"
        });

        camera.start();

        // উইন্ডো রিসাইজ হলে ক্যানভাস ঠিক করা
        window.addEventListener('resize', () => {
             canvasElement.width = window.innerWidth;
             canvasElement.height = window.innerHeight;
        });

    </script>
</body>
</html>

